<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="theme-color" content="#538c57" />
    <title>Farmácia Natural em Casa | Remédios Naturais Para Toda Família</title>
    <meta name="description" content="Descubra como tratar naturalmente diabetes, insônia, ansiedade e mais com ingredientes da sua cozinha. Guia completo de receitas naturais." />
    <meta name="format-detection" content="telephone=no" />
    
    <!-- Performance optimizations -->
    <link rel="dns-prefetch" href="//i.imgur.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://i.imgur.com" crossorigin>
    
    <!-- Inline critical CSS and fonts -->
    <style>
      /* Critical CSS inlined */
      /* Font loading optimization */
      @font-face {
        font-family: 'Poppins';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url('https://fonts.gstatic.com/s/poppins/v20/pxiEyp8kv8JHgFVrJJfecg.woff2') format('woff2');
      }
      @font-face {
        font-family: 'Poppins';
        font-style: normal;
        font-weight: 600;
        font-display: swap;
        src: url('https://fonts.gstatic.com/s/poppins/v20/pxiByp8kv8JHgFVrLEj6Z1xlFQ.woff2') format('woff2');
      }
      @font-face {
        font-family: 'Playfair Display';
        font-style: normal;
        font-weight: 600;
        font-display: swap;
        src: url('https://fonts.gstatic.com/s/playfairdisplay/v30/nuFvD-vYSZviVYUb_rj3ij__anPXJzDwcbmjWBN2PKdFvXDXbtXK-F2qO0isEw.woff2') format('woff2');
      }
      
      /* Critical styles with better performance */
      *{box-sizing:border-box;margin:0;padding:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-tap-highlight-color:transparent}
      body{font-family:'Poppins',system-ui,-apple-system,sans-serif;line-height:1.6;color:#1f2937;text-rendering:optimizeSpeed;font-size:16px;overflow-x:hidden}
      .container{max-width:1200px;margin:0 auto;padding:0 1rem;contain:layout style}
      
      /* Optimize images */
      img{max-width:100%;height:auto;display:block;loading:lazy;decoding:async}
      
      /* Above-the-fold styles */
      header{position:fixed;top:0;left:0;right:0;z-index:50;background:rgba(255,255,255,0.95);backdrop-filter:blur(8px);contain:layout style;transform:translateZ(0)}
      .hero{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(to bottom,#f2f7f2,#ffffff);contain:layout style;transform:translateZ(0)}
      .btn-primary{background:#538c57;color:white;padding:1.2rem 2.5rem;border-radius:9999px;text-decoration:none;display:inline-block;font-weight:600;transition:background-color 0.15s ease-out,transform 0.15s ease-out;font-size:18px;touch-action:manipulation}
      .btn-primary:hover,.btn-primary:focus{background:#3d7141;transform:translate3d(0,-1px,0)}
      img{content-visibility:auto;contain-intrinsic-size:200px}
      .lazy-section{content-visibility:auto;contain-intrinsic-size:400px;contain:layout style}
      section{contain:layout style}

      /* Carousel optimizations */
      .carousel-container{transform:translateZ(0);contain:layout style}
      .carousel-slide{backface-visibility:hidden;transform:translateZ(0);contain:layout}
      
      /* Mobile optimizations */
      @media (max-width: 768px) {
        body{font-size:16px}
        .btn-primary{padding:0.9rem 1.8rem;font-size:16px;min-height:44px;min-width:44px}
        h1{font-size:1.75rem !important;line-height:1.3}
        h2{font-size:1.5rem !important;line-height:1.3}
        h3{font-size:1.25rem !important;line-height:1.3}
        p{font-size:15px;line-height:1.5}
        .container{padding:0 0.75rem}
      }
      @media (max-width: 480px) {
        body{font-size:15px}
        .btn-primary{padding:0.8rem 1.5rem;font-size:15px;min-height:44px;min-width:44px}
        h1{font-size:1.6rem !important}
        h2{font-size:1.4rem !important}
        h3{font-size:1.2rem !important}
        p{font-size:14px}
        .container{padding:0 0.5rem}
      }
      
      /* Touch targets */
      button,a,[role="button"]{min-height:44px;min-width:44px;touch-action:manipulation}
      
      /* Reduce motion for accessibility */
      @media (prefers-reduced-motion: reduce) {
        *,*::before,*::after{animation-duration:0.01ms !important;animation-iteration-count:1 !important;transition-duration:0.01ms !important}
      }
      
      /* Preload critical resources */
      .preload-critical{display:none}
    </style>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.gstatic.com/s/poppins/v20/pxiEyp8kv8JHgFVrJJfecg.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://fonts.gstatic.com/s/poppins/v20/pxiByp8kv8JHgFVrLEj6Z1xlFQ.woff2" as="font" type="font/woff2" crossorigin>

    <!-- Prefetch DNS for third-party resources -->
    <link rel="dns-prefetch" href="//cdn.utmify.com.br">
    
    <script>
      // ALTERE O LINK PARA A PÁGINA QUE QUISER MOSTRAR QUANDO O USUÁRIO TENTAR SAIR
      const exitLink = 'https://gamificado-receitas.vercel.app/';
      
      // Normalizar URL para evitar perda do pixel
      function normalizeUrl() {
        const currentUrl = window.location.href;
        const baseUrl = window.location.origin;
        
        // Se a URL tem parâmetros estranhos da Vercel, limpar
        if (window.location.pathname !== '/' && window.location.pathname !== '/index.html') {
          // Preservar apenas UTMs válidos
          const urlParams = new URLSearchParams(window.location.search);
          const validParams = new URLSearchParams();
          
          // Manter apenas parâmetros de UTM e tracking
          ['utm_source', 'utm_medium', 'utm_campaign', 'utm_content', 'utm_term', 'fbclid', 'gclid'].forEach(param => {
            if (urlParams.has(param)) {
              validParams.set(param, urlParams.get(param));
            }
          });
          
          const cleanUrl = baseUrl + (validParams.toString() ? '?' + validParams.toString() : '');
          window.history.replaceState({}, document.title, cleanUrl);
        }
        
        return window.location.href;
      }
      
      // Executar normalização
      window.normalizedUrl = normalizeUrl();

      function setBackRedirect(url) {
        try {
          let urlBackRedirect = url;
          urlBackRedirect = urlBackRedirect.trim() +
            (urlBackRedirect.indexOf('?') > 0 ? '&' : '?') +
            document.location.search.replace('?', '').toString();

          history.pushState({}, '', location.href);
          history.pushState({}, '', location.href);
          history.pushState({}, '', location.href);

          window.addEventListener('popstate', () => {
            console.log('onpopstate', urlBackRedirect);
            setTimeout(() => {
              location.href = urlBackRedirect;
            }, 1);
          });
        } catch (error) {
          console.error('Error setting back redirect:', error);
        }
      }

      setBackRedirect(exitLink);
    </script>
    
    <!-- UTMify Pixel Script -->
    <script>
      window.pixelId = "68be1608013346c26842c789";
      var a = document.createElement("script");
      a.setAttribute("async", "");
      a.setAttribute("defer", "");
      a.setAttribute("src", "https://cdn.utmify.com.br/scripts/pixel/pixel.js");
      document.head.appendChild(a);
    </script>

    <!-- UTMify UTMs Script -->
    <script
      src="https://cdn.utmify.com.br/scripts/utms/latest.js"
      data-utmify-prevent-xcod-sck
      data-utmify-prevent-subids
      async
      defer
    ></script>
    
    <!-- Load analytics with intersection observer -->
    <script>
      // Enhanced tracking function with full UTMify integration
      window.trackEvent = function(eventName, eventData) {
        try {
          if (window.utmify && window.utmify.pixel) {
            window.utmify.pixel.track(eventName, {
              ...eventData,
              url: window.normalizedUrl || window.location.href,
              clean_url: true
            });
          }
        } catch (error) {
          console.error('Error tracking event:', error);
        }
      };
      
      // Enable all tracking capabilities
      window.addEventListener('load', function() {
        setTimeout(function() { try {
          // Garantir que a URL está normalizada antes do tracking
          if (!window.normalizedUrl) {
            window.normalizedUrl = normalizeUrl();
          }
          
          // Track page load
          if (window.trackEvent) {
            window.trackEvent('PageLoad', { 
              url: window.normalizedUrl,
              timestamp: new Date().toISOString(),
              userAgent: navigator.userAgent,
              screenResolution: screen.width + 'x' + screen.height,
              timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
              language: navigator.language
            });
          }
        } catch (error) {
          console.error('Error in load event:', error);
        }
        }, 200); });
    </script>
    
    <!-- Enhanced Analytics Setup -->
    <script>
      // Complete analytics setup with full tracking
      window.addEventListener('DOMContentLoaded', function() {
        try {
          // Defer analytics to improve performance
          if (!window.normalizedUrl) {
            window.normalizedUrl = normalizeUrl();
          }
          
          // Track page view
          if (window.trackEvent) {
            window.trackEvent('PageView', { 
              url: window.normalizedUrl,
              referrer: document.referrer,
              timestamp: new Date().toISOString()
            });
          }
        } catch (error) {
          console.error('Error in DOMContentLoaded:', error);
        }
      });
      
      // Track clicks with throttling
      document.addEventListener('click', function(e) {
        try {
          const target = e.target.closest('a, button, [data-track]');
          if (target && window.trackEvent) {
            const href = target.href || '';
            const isCheckoutButton = href.includes('#oferta') || target.textContent.includes('R$27') || target.textContent.includes('ACESSO');

            if (isCheckoutButton) {
              window.trackEvent('InitiateCheckout', {
                value: 27.00,
                currency: 'BRL',
                content_name: 'Farmácia Natural em Casa',
                button_text: target.textContent.trim(),
                timestamp: new Date().toISOString()
              });
            }

            window.trackEvent('Click', {
              text: target.textContent.trim(),
              href: href,
              className: target.className,
              id: target.id,
              tagName: target.tagName,
              x: e.clientX,
              y: e.clientY,
              timestamp: new Date().toISOString()
            });
          }
        } catch (error) {
          console.error('Error tracking click:', error);
        }
      }, { passive: true, capture: false });
      
      let maxScrollDepth = 0;
      let scrollTimeout;
      window.addEventListener('scroll', function() {
        if (scrollTimeout) return;
        scrollTimeout = setTimeout(() => {
          try {
            const scrollDepth = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
            if (scrollDepth > maxScrollDepth && scrollDepth % 25 === 0) {
              maxScrollDepth = scrollDepth;
              if (window.trackEvent) {
                window.trackEvent('ScrollDepth', {
                  depth: scrollDepth,
                  timestamp: new Date().toISOString()
                });
              }
            }
          } catch (error) {}
          scrollTimeout = null;
        }, 300);
      }, { passive: true });
      
      // Track time on page
      let startTime = Date.now();
      window.addEventListener('beforeunload', function() {
        try {
          const timeOnPage = Math.round((Date.now() - startTime) / 1000);
          if (window.trackEvent) {
            window.trackEvent('TimeOnPage', { 
              seconds: timeOnPage,
              timestamp: new Date().toISOString()
            });
          }
        } catch (error) {
          console.error('Error tracking time on page:', error);
        }
      });
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>